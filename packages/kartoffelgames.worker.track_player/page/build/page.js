var ur=Object.create;var ye=Object.defineProperty;var fr=Object.getOwnPropertyDescriptor;var Je=(i,e)=>(e=Symbol[i])?e:Symbol.for("Symbol."+i),ne=i=>{throw TypeError(i)};var pr=(i,e,t)=>e in i?ye(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var Ye=(i,e)=>ye(i,"name",{value:e,configurable:!0});var s=(i,e)=>()=>(i&&(e=i(i=0)),e);var l=i=>[,,,ur(i?.[Je("metadata")]??null)],Xe=["class","method","getter","setter","accessor","field","value","get","set"],ae=i=>i!==void 0&&typeof i!="function"?ne("Function expected"):i,dr=(i,e,t,r,a)=>({kind:Xe[i],name:e,metadata:r,addInitializer:n=>t._?ne("Already initialized"):a.push(ae(n||null))}),br=(i,e)=>pr(e,Je("metadata"),i[3]),c=(i,e,t,r)=>{for(var a=0,n=i[e>>1],p=n&&n.length;a<p;a++)e&1?n[a].call(t):r=n[a].call(t,r);return r},m=(i,e,t,r,a,n)=>{var p,u,y,v,O,f=e&7,h=!!(e&8),b=!!(e&16),C=f>3?i.length+1:f?h?1:2:0,x=Xe[f+5],A=f>3&&(i[C-1]=[]),N=i[C]||(i[C]=[]),E=f&&(!b&&!h&&(a=a.prototype),f<5&&(f>3||!b)&&fr(f<4?a:{get[t](){return _e(this,n)},set[t](T){return qe(this,n,T)}},t));f?b&&f<4&&Ye(n,(f>2?"set ":f>1?"get ":"")+t):Ye(a,t);for(var j=r.length-1;j>=0;j--)v=dr(f,t,y={},i[3],N),f&&(v.static=h,v.private=b,O=v.access={has:b?T=>yr(a,T):T=>t in T},f^3&&(O.get=b?T=>(f^1?_e:hr)(T,a,f^4?n:E.get):T=>T[t]),f>2&&(O.set=b?(T,ie)=>qe(T,a,ie,f^4?n:E.set):(T,ie)=>T[t]=ie)),u=(0,r[j])(f?f<4?b?n:E[x]:f>4?void 0:{get:E.get,set:E.set}:a,v),y._=1,f^4||u===void 0?ae(u)&&(f>4?A.unshift(u):f?b?n=u:E[x]=u:a=u):typeof u!="object"||u===null?ne("Object expected"):(ae(p=u.get)&&(E.get=p),ae(p=u.set)&&(E.set=p),ae(p=u.init)&&A.unshift(p));return f||br(i,a),E&&ye(a,t,E),b?f^4?n:E:a};var he=(i,e,t)=>e.has(i)||ne("Cannot "+t),yr=(i,e)=>Object(e)!==e?ne('Cannot use the "in" operator on this value'):i.has(e),_e=(i,e,t)=>(he(i,e,"read from private field"),t?t.call(i):e.get(i));var qe=(i,e,t,r)=>(he(i,e,"write to private field"),r?r.call(i,t):e.set(i,t),t),hr=(i,e,t)=>(he(i,e,"access private method"),t);var F,ge=s(()=>{F=class i extends Array{static newListWith(...e){let t=new i;return t.push(...e),t}clear(){this.splice(0,this.length)}clone(){return i.newListWith(...this)}distinct(){return i.newListWith(...new Set(this))}equals(e){if(this===e)return!0;if(!e||this.length!==e.length)return!1;for(let t=0;t<this.length;++t)if(this[t]!==e[t])return!1;return!0}remove(e){let t=this.indexOf(e);if(t!==-1)return this.splice(t,1)[0]}replace(e,t){let r=this.indexOf(e);if(r!==-1){let a=this[r];return this[r]=t,a}}toString(){return`[${super.join(", ")}]`}}});var S,Se=s(()=>{S=class extends Error{mTarget;get target(){return this.mTarget}constructor(e,t,r){super(e,r),this.mTarget=t}}});var I,$e=s(()=>{ge();Se();I=class i extends Map{add(e,t){if(!this.has(e))this.set(e,t);else throw new S("Can't add dublicate key to dictionary.",this)}clone(){return new i(this)}getAllKeysOfValue(e){return[...this.entries()].filter(a=>a[1]===e).map(a=>a[0])}getOrDefault(e,t){let r=this.get(e);return typeof r<"u"?r:t}map(e){let t=new F;for(let r of this){let a=e(r[0],r[1]);t.push(a)}return t}}});var Qe=s(()=>{});var Ze=s(()=>{});var et=s(()=>{});var tt=s(()=>{});var d,rt=s(()=>{d=class{static byteToByte(e,t=!1){let r=e&255;return t&&(r=r>127?r-256:r),r}static byteToNibble(e,t=!1){let r=e>>>4&15,a=e&15;return t&&(r=r>7?r-16:r,a=a>7?a-16:a),[r,a]}static byteToString(e,t=0){let r=e.filter(a=>a!==t);return String.fromCharCode(...r)}static byteToWorld(e,t,r=!1){let a=(e<<8)+t&65535;return r&&(a=a>32767?a-65536:a),a}static concatBytes(e){let t=null;for(let r of e)t===null?t=BigInt(r):(t<<=8n,t+=BigInt(r));return t??0n}static pickBits(e,t,r){let a=null;for(let n of r){let p=BigInt(1<<t-1-n),u=(e&p)!==0n?1n:0n;a===null?a=u:(a<<=1n,a+=u)}return a??0n}static readBytes(e,t,r){return e.slice(t,t+r)}}});var it=s(()=>{});var L=s(()=>{$e();ge();Qe();Se();Ze();et();tt();rt();it()});var M,se=s(()=>{L();M=class i{static mInstance;mConstructionParameterRetriever;mConstructorToGuidMap;mGuidToConstructorMap;constructor(){if(i.mInstance)return i.mInstance;i.mInstance=this,this.mGuidToConstructorMap=new I,this.mConstructorToGuidMap=new I,this.mConstructionParameterRetriever=new I,this.registerClass(Object,"e00cb495-e7ae-4b7f-8366-8bd706a326be",()=>({})),this.registerClass(Array,"fada0e18-119a-4668-80b6-bff1ca22547a",()=>({})),this.registerClass(Date,"b1e709cb-34d3-46f2-a9f0-f1bf57c04e69",t=>({parameter:[t.toString()]})),this.registerClass(Set,"70752b96-49c5-407c-a560-c4a294fb90ae",t=>({parameter:[[...t]]})),this.registerClass(Map,"084af2dd-573f-4bf9-bbc5-c9b627d4baf2",t=>({parameter:[[...t.entries()]]}));let e=t=>({parameter:[t.length]});this.registerClass(Int8Array,"63240f98-4309-479f-869c-db2cbf8a9fda",e),this.registerClass(Uint8Array,"d4fb16bb-29d8-4835-b6c4-f3f8ab10715a",e),this.registerClass(Uint8ClampedArray,"f38e3d89-5df3-41b8-b34b-c1dc2bba69bd",e),this.registerClass(Int16Array,"e7b7193a-c8d1-4d40-a19a-1d5174d431a4",e),this.registerClass(Uint16Array,"6c13f6c0-5dd2-456d-bdd4-dcded1a9b815",e),this.registerClass(Int32Array,"b79a08f2-a566-4fae-b587-3ae298545556",e),this.registerClass(Uint32Array,"138511cb-8584-47a8-aa3a-08bb6488bd5b",e),this.registerClass(Float32Array,"a0f6704d-42bc-4c1b-9acb-80dad04c51af",e),this.registerClass(Float64Array,"30444e6c-456f-413e-b522-26c7057fd68b",e),this.registerClass(BigInt64Array,"855c609e-1497-46cf-8c12-5e01346b38ae",e),this.registerClass(BigUint64Array,"a4a0d93b-36cf-422b-8323-75484c58a0ae",e)}getClass(e){let t=this.mGuidToConstructorMap.get(e);if(!t)throw new S(`ClassId "${e}" is not registered.`,this);return t}getClassId(e){let t=this.mConstructorToGuidMap.get(e);if(!t)throw new S(`Constructor "${e.name}" is not registered.`,this);return t}getObjectConstructionParameter(e){let t=this.getClassId(e.constructor);return this.mConstructionParameterRetriever.get(t)(e)}registerClass(e,t,r){this.mGuidToConstructorMap.add(t,e),this.mConstructorToGuidMap.add(e,t),this.mConstructionParameterRetriever.add(t,r)}}});function o(i){return function(e){let t=new WeakMap,r=class extends e{constructor(...a){super(...a),t.set(this,a)}};return new M().registerClass(r,i,a=>({parameter:t.get(a),requiredValues:[]})),r}}var at=s(()=>{se()});var nt=s(()=>{L();se()});var oe,st=s(()=>{L();se();oe=class{objectify(e){let t=new I;return this.objectifyUnknown(e,t)}serialize(e){return JSON.stringify(this.objectify(e))}objectifyObject(e,t){if(t.has(e))return{"&type":"reference","&objectId":t.get(e)};let r=globalThis.crypto.randomUUID();if(t.set(e,r),typeof e=="symbol")return{"&type":"symbol","&objectId":r,"&values":{description:e.description}};let a=e.constructor,n=new M,p=n.getClassId(a),u=n.getObjectConstructionParameter(e),y=u.parameter?.map(h=>this.objectifyUnknown(h,t)),v=u.requiredValues?.map(h=>({propertyName:h.propertyName,value:this.objectifyUnknown(h.value,t)})),O={},f=Object.getOwnPropertyDescriptors(e);for(let h of Object.keys(f).sort()){let b=f[h];b.writable&&(O[h]=this.objectifyUnknown(b.value,t))}return{"&type":"class","&constructor":p,"&objectId":r,"&initialisation":{parameter:y??[],requiredValues:v??[]},"&values":O}}objectifyUnknown(e,t){switch(typeof e){case"string":case"number":case"boolean":case"undefined":return e;case"bigint":return{"&type":"bigint","&number":e.toString()};case"symbol":case"object":{let a=e;return a===null?null:this.objectifyObject(a,t)}default:return}}}});var g=s(()=>{at();nt();se();st()});var ot,ve,B,lt=s(()=>{g();ot=[o("3fd4b733-df66-4499-819a-78002d25b649")];B=class{mEffectList;get effects(){return this.mEffectList}constructor(){this.mEffectList=new Array}removeEffect(e){let t=this.mEffectList.find(r=>r.constructor===e.constructor);if(typeof t<"u"){let r=this.mEffectList.indexOf(t);r!==-1&&this.mEffectList.splice(r,1)}}setEffect(e){let t=this.mEffectList.find(r=>r.constructor===e.constructor);if(typeof t<"u"){let r=this.mEffectList.indexOf(t);r!==-1&&this.mEffectList.splice(r,1)}this.mEffectList.push(e)}};ve=l(null),B=m(ve,0,"DivisionChannel",ot,B),c(ve,1,B)});var ct,Te,D,mt=s(()=>{L();g();lt();ct=[o("dc682441-633d-496f-b8a2-6654b27389e3")];D=class{mChannelList;get channelCount(){return this.mChannelList.length}constructor(){this.mChannelList=new Array}addChannel(e){let t=new B;if(e===null||e===this.mChannelList.length)this.mChannelList.push(t);else{if(e>this.mChannelList.length)throw new S("Channel index would produce gaps with missing channels.",this);this.mChannelList[e]=t}return t}getChannel(e){return this.mChannelList[e]??new B}removeChannel(e){e>=this.mChannelList.length-1||(e===this.mChannelList.length-1?this.mChannelList.pop():this.mChannelList[e]=new B)}};Te=l(null),D=m(Te,0,"Division",ct,D),c(Te,1,D)});var ut,Ee,H,ft=s(()=>{L();g();mt();ut=[o("e9a8b42d-c2e2-4466-8a5d-5c24290310f2")];H=class{mDivisionList;get divisionCount(){return this.mDivisionList.length}constructor(){this.mDivisionList=new Array}addDivision(e){let t=new D;if(typeof e>"u"||e===this.mDivisionList.length)this.mDivisionList.push(t);else{if(e>this.mDivisionList.length)throw new S("Division index would produce gaps with missing dicisions.",this);this.mDivisionList[e]=t}return t}getDivision(e){return this.mDivisionList[e]??new D}removeDivision(e){e>=this.mDivisionList.length-1||(e===this.mDivisionList.length-1?this.mDivisionList.pop():this.mDivisionList[e]=new D)}};Ee=l(null),H=m(Ee,0,"Pattern",ut,H),c(Ee,1,H)});var pt,Oe,U,dt=s(()=>{L();g();ft();pt=[o("79cfd5d5-1575-45f4-a056-8248811d3deb")];U=class{mPatternList;mSongPositionList;get patternCount(){return this.mPatternList.length}get songPositions(){return this.mSongPositionList}set songPositions(e){this.mSongPositionList=e}constructor(){this.mPatternList=new Array,this.mSongPositionList=new Array}addPattern(e){let t=new H;if(typeof e>"u"||e===this.mPatternList.length)this.mPatternList.push(t);else{if(e>this.mPatternList.length)throw new S("Pattern index would produce gaps with missing pattern.",this);this.mPatternList[e]=t}return t}getPattern(e){return this.mPatternList[e]??new H}removePattern(e){e>=this.mPatternList.length||(e===this.mPatternList.length-1?this.mPatternList.pop():this.mPatternList[e]=new H)}};Oe=l(null),U=m(Oe,0,"PatternList",pt,U),c(Oe,1,U)});var bt,Ce,k,yt=s(()=>{L();g();bt=[o("217a4b0a-1a1a-4c93-9228-ad04e032f5f9")];k=class{mData;mFineTune;mName;mRepeatLength;mRepeatStartOffset;mVolume;get data(){return this.mData}set data(e){this.mData=e}get fineTune(){return this.mFineTune}set fineTune(e){this.mFineTune=e}get name(){return this.mName}set name(e){this.mName=e}get repeatLength(){return this.mRepeatLength}get repeatOffset(){return this.mRepeatStartOffset}get volume(){return this.mVolume}set volume(e){if(e>1||e<0)throw new S("Volume out of range [0..1]",this);this.mVolume=e}constructor(){this.mName="",this.mData=new Float32Array(1),this.mVolume=0,this.mFineTune=0,this.mRepeatLength=1,this.mRepeatStartOffset=0}setRepeatInformation(e,t){this.mRepeatStartOffset=e,this.mRepeatLength=t}};Ce=l(null),k=m(Ce,0,"Sample",bt,k),c(Ce,1,k)});var ht,xe,K,gt=s(()=>{L();g();yt();ht=[o("930859f4-3833-4989-88d4-9b7a8f2d0bf7")];K=class{mSampleList;get sampleCount(){return this.mSampleList.length}constructor(){this.mSampleList=new Array}addSample(e){let t=new k;if(typeof e>"u"||e===this.mSampleList.length)this.mSampleList.push(t);else{if(e>this.mSampleList.length)throw new S("Sample index would produce gaps with missing samples.",this);this.mSampleList[e]=t}return t}getSample(e){return this.mSampleList[e]??new k}removeSample(e){e>=this.mSampleList.length-1||(e===this.mSampleList.length-1?this.mSampleList.pop():this.mSampleList[e]=new k)}};xe=l(null),K=m(xe,0,"SampleList",ht,K),c(xe,1,K)});var St,Ae,W,vt=s(()=>{g();dt();gt();St=[o("5fab5714-ec6e-4057-82df-1749054035c6")];W=class{mPattern;mSamples;mSongName;get pattern(){return this.mPattern}get samples(){return this.mSamples}get songName(){return this.mSongName}set songName(e){this.mSongName=e}constructor(){this.mSongName="",this.mPattern=new U,this.mSamples=new K}};Ae=l(null),W=m(Ae,0,"GenericModule",St,W),c(Ae,1,W)});var ce,Tt=s(()=>{L();ce=class{mLastEffectType;constructor(){this.mLastEffectType=new I}add(e){let t=e.constructor;this.mLastEffectType.set(t,e)}last(e){return this.mLastEffectType.get(e)}}});var me,Et=s(()=>{vt();L();Tt();me=class{mData;mEffectParser;constructor(e,t){this.mData=e,this.mEffectParser=t}parse(){let e=new W,t=this.calculateModuleParseOptions(this.mData),r=d.readBytes(this.mData,t.name.byteOffset,t.name.bytes);e.songName=d.byteToString(r,t.name.emptyValue);let a=new Array,n=t.songPositions.byteOffset;for(let h=0;h<t.songPositions.count;h++){let b=d.readBytes(this.mData,n,t.songPositions.valueByteSize);a.push(Number(d.concatBytes(b))),n+=t.songPositions.valueByteSize}e.pattern.songPositions=a;let p=Math.max(...a)+1,u=t.pattern.byteOffset,y=new I;for(let h=0;h<p;h++){let b=e.pattern.addPattern(h);for(let C=0;C<t.pattern.division.count;C++){let x=b.addDivision(C);for(let A=0;A<t.pattern.channel.count;A++){let N=x.addChannel(A),E=d.readBytes(this.mData,u,t.pattern.channel.bytes),j=this.parseChannel(E),T=y.get(A);T||(T=new ce,y.set(A,T));for(let ie of j){let mr=this.mEffectParser.parseChannel(A,ie,T);for(let We of mr)N.setEffect(We),T.add(We)}u+=t.pattern.channel.bytes}}}let v=t.sample.head.offset,O=t.sample.body.byteOffset,f=t.sample.body.valueByteSize;for(let h=0;h<t.sample.count;h++){let b=e.samples.addSample(h),C=d.readBytes(this.mData,v,t.sample.head.bytes),x=this.parseSampleHead(C);b.name=x.name,b.fineTune=x.fineTune,b.volume=x.volume,b.setRepeatInformation(x.repeatOffset*f,x.repeatLength*f);let A=x.bodyLength*f-t.sample.body.dataStartByteOffset,N=O+t.sample.body.dataStartByteOffset,E=d.readBytes(this.mData,N,A);b.data=this.parseSampleBody(E),v+=t.sample.head.bytes,O+=x.bodyLength*f}return e}}});var Ot,Ie,Y,Ct=s(()=>{g();Ot=[o("a0572a01-adc4-479b-b874-7969d26ef0c8")];Y=class{mFinetune;get finetune(){return this.mFinetune}set finetune(e){this.mFinetune=e}constructor(){this.mFinetune=0}};Ie=l(null),Y=m(Ie,0,"SetFinetuneEffect",Ot,Y),c(Ie,1,Y)});var ue=s(()=>{});var xt,Le,G,It=s(()=>{g();ue();xt=[o("ad509656-422c-464e-9fd0-b26e417d7219")];G=class{mPitch;get pitch(){return this.mPitch}set pitch(e){this.mPitch=e}constructor(){this.mPitch=428}};Le=l(null),G=m(Le,0,"SetPitchEffect",xt,G),c(Le,1,G)});var Lt,we,_,wt=s(()=>{g();Lt=[o("413db579-c8e3-405c-981c-3a791ac45259")];_=class{mTicks;get ticks(){return this.mTicks}set ticks(e){this.mTicks=e}constructor(){this.mTicks=0}};we=l(null),_=m(we,0,"CutSampleEffect",Lt,_),c(we,1,_)});var Pt,Pe,q,Gt=s(()=>{g();Pt=[o("bff7a452-d645-4264-a132-d996bb37f5c1")];q=class{mTicks;get ticks(){return this.mTicks}set ticks(e){this.mTicks=e}constructor(){this.mTicks=0}};Pe=l(null),q=m(Pe,0,"DelaySampleEffect",Pt,q),c(Pe,1,q)});var Bt,Ge,J,Dt=s(()=>{g();Bt=[o("111c5fcf-ae55-4f1d-8d5a-77f385129ce5")];J=class{mInvert;get invert(){return this.mInvert}set invert(e){this.mInvert=e}constructor(){this.mInvert=!1}};Ge=l(null),J=m(Ge,0,"InvertSampleLoopEffect",Bt,J),c(Ge,1,J)});var Ht,Be,X,kt=s(()=>{g();Ht=[o("4b8bbb2f-d1ed-490c-ac37-0aae07a66b99")];X=class{mRetriggerTickInterval;get tickInterval(){return this.mRetriggerTickInterval}set tickInterval(e){this.mRetriggerTickInterval=e}constructor(){this.mRetriggerTickInterval=0}};Be=l(null),X=m(Be,0,"RetriggerSampleEffect",Ht,X),c(Be,1,X)});var zt,De,$,Nt=s(()=>{g();zt=[o("5f87532e-eb80-4e0b-8563-b5530f4d8f0c")];$=class{mOffset;get offset(){return this.mOffset}set offset(e){this.mOffset=e}constructor(){this.mOffset=0}};De=l(null),$=m(De,0,"SampleOffsetEffect",zt,$),c(De,1,$)});var jt,He,V,Mt=s(()=>{g();jt=[o("a82c0549-79ef-4059-b0bc-f969fda0d012")];V=class{mPanning;get panning(){return this.mPanning}set panning(e){this.mPanning=e}constructor(){this.mPanning=0}};He=l(null),V=m(He,0,"SetPanningEffect",jt,V),c(He,1,V)});var Vt,ke,Q,Rt=s(()=>{g();Vt=[o("4d89d145-7a92-4639-bebf-cfaa916e77ff")];Q=class{mSampleIndex;get sampleIndex(){return this.mSampleIndex}set sampleIndex(e){this.mSampleIndex=e}constructor(){this.mSampleIndex=0}};ke=l(null),Q=m(ke,0,"SetSampleEffect",Vt,Q),c(ke,1,Q)});var Ft,ze,Z,Ut=s(()=>{g();Ft=[o("371d3e18-350a-4737-8fb2-f6dee52e031c")];Z=class{mBeatsPerMinute;get beatsPerMinute(){return this.mBeatsPerMinute}set beatsPerMinute(e){this.mBeatsPerMinute=e}constructor(){this.mBeatsPerMinute=0}};ze=l(null),Z=m(ze,0,"SetBeatsPerMinuteEffect",Ft,Z),c(ze,1,Z)});var Kt,Ne,ee,Wt=s(()=>{g();Kt=[o("1641d552-51fc-4f24-8e01-52a29de9271c")];ee=class{mSpeed;get speed(){return this.mSpeed}set speed(e){this.mSpeed=e}constructor(){this.mSpeed=0}};Ne=l(null),ee=m(Ne,0,"SetSpeedEffect",Kt,ee),c(Ne,1,ee)});var Yt,je,te,_t=s(()=>{g();Yt=[o("cc8156b4-f9ff-4eba-94fb-2640f525bac2")];te=class{mVolume;get volume(){return this.mVolume}set volume(e){this.mVolume=e}constructor(){this.mVolume=1}};je=l(null),te=m(je,0,"SetVolumeEffect",Yt,te),c(je,1,te)});var fe=s(()=>{});var qt,Me,z,Xt=s(()=>{g();fe();qt=[o("9c97f93e-a223-4f7b-a036-a2cd01c4ff0a")];z=class{mDirection;mVolumeChangePerTick;get direction(){return this.mDirection}set direction(e){this.mDirection=e}get volumeChangePerTick(){return this.mVolumeChangePerTick}set volumeChangePerTick(e){this.mVolumeChangePerTick=e}constructor(){this.mVolumeChangePerTick=0,this.mDirection=2}};Me=l(null),z=m(Me,0,"VolumeSlideEffect",qt,z),c(Me,1,z)});var le,$t=s(()=>{le=class{mIgnorePitch;mIgnoreSample;mHistory;mData;get history(){return this.mHistory}get ignorePitch(){return this.mIgnorePitch}get ignoreSample(){return this.mIgnoreSample}get data(){return this.mData}constructor(e,t,r,a,n,p){this.mIgnorePitch=!1,this.mIgnoreSample=!1,this.mHistory=t,this.mData={channelIndex:e,parameter:{first:r,second:a},pitch:n,sample:p}}preventPitch(){this.mIgnorePitch=!0}preventSample(){this.mIgnoreSample=!0}}});var pe,Qt=s(()=>{L();$t();pe=class{mEffectHandler;mPitchHandler;mSampleHandler;constructor(){this.mEffectHandler=new F,this.mPitchHandler=null,this.mSampleHandler=null}addEffectHandler(e,t){let r=[...e],a=r.reduce((u,y)=>y!=="1"&&y!=="0"&&y!=="x"&&y!=="y"?u:isNaN(y)?u+"0":u+"1",""),n=r.reduce((u,y)=>y!=="1"&&y!=="0"&&y!=="x"&&y!=="y"?u:isNaN(y)?u+"0":u+y,""),p=r.filter(u=>u==="1"||u==="0"||u==="x"||u==="y").join("");this.mEffectHandler.push({allocation:{bitmask:parseInt(a,2),pattern:p,fixedBits:parseInt(n,2)},handler:t})}addPitchHandler(e){this.mPitchHandler=e}addSampleHandler(e){this.mSampleHandler=e}parseChannel(e,t,r){let a=this.mEffectHandler.find(u=>(t.effect&u.allocation.bitmask)===u.allocation.fixedBits),n,p=new Array;if(!a)n=new le(e,r,0,0,t.pitch,t.sample);else{let u=[...t.effect.toString(2)].reverse(),y=[...a.allocation.pattern].reverse(),v="",O="";for(let b=0;b<y.length;b++){let C=y[b];C==="x"?v=(u[b]??0)+v:C==="y"&&(O=(u[b]??0)+O)}let f=parseInt(v,2),h=parseInt(O,2);n=new le(e,r,f,h,t.pitch,t.sample),p.push(...a.handler(n))}if(!n.ignorePitch){if(!this.mPitchHandler)throw new S("No pitch handler is registered.",this);p.push(...this.mPitchHandler(n))}if(!n.ignoreSample){if(!this.mSampleHandler)throw new S("No sample handler is registered.",this);p.push(...this.mSampleHandler(n))}return p}}});var Zt,Ve,re,er=s(()=>{g();Zt=[o("af9665cc-4859-4d3e-ad0f-6f249dcfc60a")];re=class{mNoteList;get notes(){return this.mNoteList}constructor(){this.mNoteList=new Array}addNote(e){this.mNoteList.push(e)}};Ve=l(null),re=m(Ve,0,"ArpeggioEffect",Zt,re),c(Ve,1,re)});var tr,Re,w,rr=s(()=>{g();fe();ue();tr=[o("c73b8272-d6db-432d-a2af-2a364cff187e")];w=class{mDirection;mGlissandoSensitive;mNoteBoundary;mPeriodSlidePerTick;get direction(){return this.mDirection}set direction(e){this.mDirection=e}get glissandoSensitive(){return this.mGlissandoSensitive}set glissandoSensitive(e){this.mGlissandoSensitive=e}get noteBoundary(){return this.mNoteBoundary}set noteBoundary(e){this.mNoteBoundary=e}get periodSlidePerTick(){return this.mPeriodSlidePerTick}set periodSlidePerTick(e){this.mPeriodSlidePerTick=e}constructor(){this.mPeriodSlidePerTick=0,this.mDirection=2,this.mNoteBoundary=0,this.mGlissandoSensitive=!1}};Re=l(null),w=m(Re,0,"PeriodSlideEffect",tr,w),c(Re,1,w)});var Fe=s(()=>{});var ir,Ue,P,ar=s(()=>{g();Fe();ir=[o("4b6b14f0-1f2f-4a5f-8eca-17ca284e6cf2")];P=class{mAmplitude;mCirclesPerTick;mEffectTarget;get amplitude(){return this.mAmplitude}set amplitude(e){this.mAmplitude=e}get circlePerTick(){return this.mCirclesPerTick}set circlePerTick(e){this.mCirclesPerTick=e}get target(){return this.mEffectTarget}set target(e){this.mEffectTarget=e}constructor(){this.mAmplitude=0,this.mCirclesPerTick=0,this.mEffectTarget=1}};Ue=l(null),P=m(Ue,0,"WaveformEffect",ir,P),c(Ue,1,P)});var nr,Ke,R,sr=s(()=>{g();nr=[o("7ba5c774-d66e-4f58-a23d-49a2973aa4a3")];R=class{mDivisionIndex;mSongPositionIndex;mSongPositionShiftMode;get divisionIndex(){return this.mDivisionIndex}set divisionIndex(e){this.mDivisionIndex=e}get songPosition(){return this.mSongPositionIndex}set songPosition(e){this.mSongPositionIndex=e}get songPositionShiftMode(){return this.mSongPositionShiftMode}set songPositionShiftMode(e){this.mSongPositionShiftMode=e}constructor(){this.mDivisionIndex=0,this.mSongPositionIndex=0,this.mSongPositionShiftMode=!1}};Ke=l(null),R=m(Ke,0,"PositionJumpEffect",nr,R),c(Ke,1,R)});var de,or=s(()=>{Ct();It();wt();Gt();Dt();kt();Nt();Mt();Rt();Ut();Wt();_t();Xt();fe();ue();Qt();er();rr();ar();Fe();sr();de=class i extends pe{static PITCH_TABLE={0:0,1712:1712,1616:1616,1525:1525,1440:1440,1357:1357,1281:1281,1209:1209,1141:1141,1077:1077,1017:1017,961:961,907:907,856:856,808:808,762:762,720:720,678:678,640:640,604:604,570:570,538:538,508:508,480:480,453:453,428:428,404:404,381:381,360:360,339:339,320:320,302:302,285:285,269:269,254:254,240:240,226:226,214:214,202:202,190:190,180:180,170:170,160:160,151:151,143:143,135:135,127:127,120:120,113:113,107:107,101:101,95:95,90:90,85:85,80:80,76:76,71:71,67:67,64:64,60:60,57:57};constructor(){super(),this.addPitchHandler(e=>{let t=new Array,r=i.PITCH_TABLE[e.data.pitch];if(e.data.pitch!==0){let a=new G;a.pitch=r,t.push(a)}return t}),this.addSampleHandler(e=>{let t=new Array;if(e.data.sample>0){let r=new Q;r.sampleIndex=e.data.sample-1,t.push(r);let a=(e.data.channelIndex+3)%4>1,n=new V;n.panning=a?-1:1,t.push(n)}return t}),this.addEffectHandler("0000.xxxx.yyyy",e=>{if(e.data.parameter.first===0&&e.data.parameter.second===0)return[];let t=new re;return t.addNote(e.data.pitch),t.addNote(e.data.pitch*Math.pow(Math.pow(2,1/12),e.data.parameter.first)),t.addNote(e.data.pitch*Math.pow(Math.pow(2,1/12),e.data.parameter.second)),t.addNote(e.data.pitch),[t]}),this.addEffectHandler("0001.xxxx.yyyy",e=>{let t=new w;return t.direction=1,t.noteBoundary=113,t.periodSlidePerTick=e.data.parameter.first*16+e.data.parameter.second,[t]}),this.addEffectHandler("0010.xxxx.yyyy",e=>{let t=new w;return t.direction=2,t.noteBoundary=856,t.periodSlidePerTick=e.data.parameter.first*16+e.data.parameter.second,[t]}),this.addEffectHandler("0011.xxxx.yyyy",e=>{let t=new w;if(e.data.parameter.first!==0||e.data.parameter.second!==0){let r=e.history.last(G)?.pitch??428;t.direction=r<e.data.pitch?2:1,t.noteBoundary=e.data.pitch,t.periodSlidePerTick=e.data.parameter.first*16+e.data.parameter.second}else{let r=e.history.last(w),a=r?.noteBoundary??428,n=r?.periodSlidePerTick??0,p=e.history.last(G)?.pitch??428;t.direction=p<a?2:1,t.noteBoundary=a,t.periodSlidePerTick=n}return e.preventPitch(),[t]}),this.addEffectHandler("0100.xxxx.yyyy",e=>{let t=e.data.pitch||(e.history.last(G)?.pitch??428),r=new P;if(e.data.parameter.first!==0&&e.data.parameter.second!==0)r.target=1,r.circlePerTick=e.data.parameter.first/64,r.amplitude=t*Math.pow(Math.pow(2,1/12),e.data.parameter.second/16);else{let a=e.history.last(P);r.amplitude=a?.amplitude??0,r.circlePerTick=a?.amplitude??1,r.target=1}return[r]}),this.addEffectHandler("0101.xxxx.yyyy",e=>{let t=new z;e.data.parameter.first!==0?(t.direction==1,t.volumeChangePerTick=e.data.parameter.first):(t.direction==1,t.volumeChangePerTick=e.data.parameter.second);let r=new w,a=e.history.last(w),n=a?.noteBoundary??428,p=a?.periodSlidePerTick??0,u=e.history.last(G)?.pitch??428;return r.direction=u<n?2:1,r.noteBoundary=n,r.periodSlidePerTick=p,[t,r]}),this.addEffectHandler("0110.xxxx.yyyy",e=>{let t=new z;e.data.parameter.first!==0?(t.direction==1,t.volumeChangePerTick=e.data.parameter.first):(t.direction==1,t.volumeChangePerTick=e.data.parameter.second);let r=new P,a=e.history.last(P);return r.amplitude=a?.amplitude??0,r.circlePerTick=a?.amplitude??1,r.target=1,[t,r]}),this.addEffectHandler("0111.xxxx.yyyy",e=>{let t=new P;if(e.data.parameter.first!==0&&e.data.parameter.second!==0)t.target=2,t.circlePerTick=e.data.parameter.first/64,t.amplitude=e.data.parameter.second;else{let r=e.history.last(P);t.amplitude=r?.amplitude??0,t.circlePerTick=r?.amplitude??1,t.target=2}return[t]}),this.addEffectHandler("1000.xxxx.yyyy",e=>{let t=new V;return t.panning=(e.data.parameter.first*16+e.data.parameter.second-64)/64,[t]}),this.addEffectHandler("1001.xxxx.yyyy",e=>{let t=new $;return t.offset=e.data.parameter.first*4096+e.data.parameter.second*256,[t]}),this.addEffectHandler("1010.xxxx.yyyy",e=>{let t=new z;return t.direction=e.data.parameter.first>0?1:2,t.volumeChangePerTick=(e.data.parameter.first>0?e.data.parameter.first:e.data.parameter.second)/64,[t]}),this.addEffectHandler("1011.xxxx.yyyy",e=>{let t=new R;return t.divisionIndex=0,t.songPosition=e.data.parameter.first*16+e.data.parameter.second,[t]}),this.addEffectHandler("1100.xxxx.yyyy",e=>{let t=new te;return t.volume=(e.data.parameter.first*16+e.data.parameter.second)/64,[t]}),this.addEffectHandler("1101.xxxx.yyyy",e=>{let t=new R;return t.divisionIndex=e.data.parameter.first*10+e.data.parameter.second,t.songPosition=1,t.songPositionShiftMode=!0,[t]}),this.addEffectHandler("1110.0101.yyyy",e=>{let t=new Y;return t.finetune=e.data.parameter.second,[t]}),this.addEffectHandler("1110.1001.yyyy",e=>{let t=new Array;if(e.data.parameter.second>0){let r=new X;r.tickInterval=e.data.parameter.second,t.push(r)}return t}),this.addEffectHandler("1110.1100.yyyy",e=>{let t=new _;return t.ticks=e.data.parameter.second,[t]}),this.addEffectHandler("1110.1101.yyyy",e=>{let t=new q;return t.ticks=e.data.parameter.second,[t]}),this.addEffectHandler("1110.1111.yyyy",e=>{let t=new J;return t.invert=e.data.parameter.second>0,[t]}),this.addEffectHandler("1111.xxxx.yyyy",e=>{let t=new Array,r=e.data.parameter.first*16+e.data.parameter.second;if(r=Math.max(r,1),r<=32){let a=new ee;a.speed=r,t.push(a)}else{let a=new Z;a.beatsPerMinute=r,t.push(a)}return t})}}});var be,lr=s(()=>{L();Et();or();be=class i extends me{static NAME_BYTE_LENGTH=20;static SAMPLE_HEADER_BYTE_LENGTH=30;constructor(e){super(e,new de)}calculateModuleParseOptions(e){let t=this.getExtensionName(e),r=this.getChannelCount(t),a=t!==""?31:15,n=this.getPatternCount(e,a),p=i.NAME_BYTE_LENGTH+a*i.SAMPLE_HEADER_BYTE_LENGTH+1+1,u=this.getSongPositionLength(e,a),y=i.NAME_BYTE_LENGTH+i.SAMPLE_HEADER_BYTE_LENGTH*a;y+=130+(a===31?4:0);let v=i.NAME_BYTE_LENGTH;return v+=i.SAMPLE_HEADER_BYTE_LENGTH*a,v+=130+(a===31?4:0),v+=64*4*r*n,{name:{byteOffset:0,bytes:i.NAME_BYTE_LENGTH,emptyValue:0},songPositions:{count:u,valueByteSize:1,byteOffset:p},pattern:{byteOffset:y,division:{count:64},channel:{count:r,bytes:4}},sample:{count:a,head:{bytes:i.SAMPLE_HEADER_BYTE_LENGTH,offset:i.NAME_BYTE_LENGTH},body:{byteOffset:v,valueByteSize:2,dataStartByteOffset:2}}}}parseChannel(e){let t=d.concatBytes(e),r=Number(d.pickBits(t,32,[0,1,2,3,16,17,18,19])),a=Number(d.pickBits(t,32,[4,5,6,7,8,9,10,11,12,13,14,15])),n=Number(d.pickBits(t,32,[20,21,22,23,24,25,26,27,28,29,30,31])),p=new Array;return p.push({effect:n,pitch:a,sample:r}),p}parseSampleHead(e){let y=d.readBytes(e,0,22),v=d.byteToString(y),O=d.readBytes(e,22,2),f=d.byteToWorld(O[0],O[1]),h=d.readBytes(e,24,1),b=d.byteToNibble(h[0],!0)[1],C=d.readBytes(e,25,1),x=d.byteToByte(C[0])/64,A=d.readBytes(e,26,2),N=d.byteToWorld(A[0],A[1]);N-=2;let E=d.readBytes(e,28,2),j=d.byteToWorld(E[0],E[1]);return j-=2,{name:v,volume:x,fineTune:b,repeatOffset:N,repeatLength:j,bodyLength:f}}parseSampleBody(e){let t=new Float32Array(e.length);for(let r=0;r<e.length;r++)t[r]=d.byteToByte(e[r],!0)/128;return t}getExtensionName(e){let r=i.NAME_BYTE_LENGTH+31*i.SAMPLE_HEADER_BYTE_LENGTH+130,a=d.readBytes(e,r,4),n=d.byteToString(a);return["M.K.","FLT4","FLT8","M!K!","6CHN","8CHN"].includes(n)?n:""}getChannelCount(e){switch(e){case"FLT8":case"8CHN":return 8;case"6CHN":return 6;default:return 4}}getPatternCount(e,t){let r=i.NAME_BYTE_LENGTH+t*i.SAMPLE_HEADER_BYTE_LENGTH+1+1,a=d.readBytes(e,r,128);return Math.max(...a)+1}getSongPositionLength(e,t){let r=i.NAME_BYTE_LENGTH+t*i.SAMPLE_HEADER_BYTE_LENGTH;return d.readBytes(e,r,1)[0]}}});var Sr={};var cr=s(()=>{g();lr();(async()=>{let i=await(async()=>{let p=await(await fetch("/sample.mod")).arrayBuffer();return new Uint8Array(p)})(),e=new be(i).parse(),t=new AudioContext;await t.audioWorklet.addModule("/bundle/Kartoffelgames.Worker.Track_Player.jsworker");let r=t.createOscillator(),a=new AudioWorkletNode(t,"Trackplayer");a.port.postMessage({type:"load",data:new oe().serialize(e)}),r.connect(a).connect(t.destination),document.addEventListener("click",()=>{r.start()})})()});(()=>{let i=new WebSocket("ws://127.0.0.1:8088");i.addEventListener("open",()=>{console.log("Refresh connection established")}),i.addEventListener("message",e=>{console.log("Bundle finished. Start refresh"),e.data==="REFRESH"&&window.location.reload()})})();Promise.resolve().then(()=>cr());
//# sourceMappingURL=page.js.map
